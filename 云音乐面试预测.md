# 自定义 View，ViewGroup，的绘制流程
## View 流程
### 控制View的大小 测量
    - measure -> onMeasure
    - onMeasure 找出控件的大小
    - onMeasure方法里面必须调用setMeasuredDimension();，保存测量的宽高的值mMeasuredWidth，mMeasuredHeight

### 控制View的位置 布局
    - layout
    - 四个位置l, t, r, b 相对于父容器
    - layout->setFrame 完成了对四个成员变量的赋值mLeft, mTop, mRight, mBottom
    - onLayout 晚于 setFrame 调用，view 一般可以不写这个。

### View的绘制 绘制
    - draw - > onDraw 进行绘制

## ViewGroup流程

### ViewGroup的测量
相同点:measure -> onMeasure
不同点：作为一个父容器，需要去测量孩子，拿到孩子申请的宽高，打包成对孩子的期望，去测量孩子（child.measure）。再测量自己，成功之后，可能会二次测量孩子

### ViewGroup的布局
相同点:layout(l, t, r, b)
不同点:ViewGroup要去覆写onLayout,去布局孩子，调用孩子layout方法，指定孩子上下左右的位置。其自己其实可以无所谓

### ViewGroup绘制
会调用 dispatchDraw() 来绘制子view

## getWidth和getMeasuredWidth的区别
getWidth = mRight - mLeft, mRight和mLeft只有layout->setFrame才有值
getMeasuredWidth 测量之后才有值

# ViewGroup 中的 onDraw 是否每次都会执行，原理是啥
在默认状态下，ViewGroup的背景为透明的，而在View中的draw方法中表示只有不透明才执行onDraw，这也就导致后续ViewGroup的onDraw失效。

# invalidate 和 requestLayout 的区别

## requestLayout：
requestLayout会直接递归调用父窗口的requestLayout，直到ViewRootImpl,然后触发peformTraversals，由于mLayoutRequested为true，会导致onMeasure和onLayout被调用。不一定会触发OnDraw。requestLayout触发onDraw可能是因为在在layout过程中发现l,t,r,b和以前不一样，那就会触发一次invalidate，所以触发了onDraw，也可能是因为别的原因导致mDirty非空（比如在跑动画）

## invalidate：
view的invalidate不会导致ViewRootImpl的invalidate被调用，而是递归调用父view的invalidateChildInParent，直到ViewRootImpl的invalidateChildInParent，然后触发peformTraversals，会导致当前view被重绘,由于mLayoutRequested为false，不会导致onMeasure和onLayout被调用，而OnDraw会被调用

## TextView 的 setText 调用的是 invalidata 还是 requestLayout，如何实现调用另一个

## ScrollView 的 onMeasure

## 内存回收相关的，如何确保内存回收发生了，回收了哪些
引用队列

## Kotlin 的 object 关键字能做什么事
- 定义单例类
- 伴生对象

## Retrofit 如何生成一个网络请求
返回一个动态代理对象，在调用方法的时候，会调用invoke方法生成一个方法对象（MethodService），这个里面有封装的url和请求入参，由这个对象来进行请求。

## 一个静止的页面, 比如一个显示着的 TextView。它还会持续收到 vSync 信号进行刷新吗?
不会。这个是由 Chroghper 在post 方法中注册才会收到 onvSync 时间，不然不会的。

## 是不是每 16ms 都会调用 onDraw 方法
不是

## View 的三种测量模式分别应用在哪些场景
AT_MOST（子控件最大是这么大） EXACTLY UNSPECIFIED（父控件没有给子控件任何限制）

## ViewGroup 绘制 Draw 的流程是怎么样的
### View.draw
    - Draw the background，通过View.drawBackground方法来实现
    - 如果需要，保存画布层（Canvas.saveLayer）为淡入或淡出做准备
    - draw the content，通过View.onDraw方法来实现，一般自定义View，就是通过该方法来绘制内容
    - draw the children，通过View.dispatchDraw方法来实现，ViewGroup都会实现该方法，来绘制自己的子View
    - 绘制淡入淡出的相关内容并恢复之前保存的画布层
    - draw decorations (scrollbars)，通过View.onDrawScrollBars方法来实现

如果我们想让ViewGroup.draw被调用。
1. 调用View.setWillNotDraw(false)，取消View.mViewFlags中的WILL_NOT_DRAW标识
2. 为ViewGroup设置背景图

首次渲染View树的时候，只要ViewGroup.draw方法被调用了，那么ViewGroup.onDraw就会被调用。
但是后续子View.invalidate的时候，在ViewGroup.draw方法被调用的前提下，还要子View是非实心的，那么ViewGroup.onDraw和ViewGroup.drawBackground才会被调用

## 通过 Drawable 实现动画和 View 实现动画有什么区别
Drawable 帧动画。性能差，他是每次通过 addFrame 增加一个图片，性能差
View 属性动画，绘制性能好以translateX为例，它其实是修改了对应的属性值，通过 RenderThread 来进行修改

## RecyclerView 怎么划分割线
使用 ItemDecoration。来绘制。在onDraw方法中，绘制一个矩形。使用一个Drawable来绘制。getItemOffsets 此方法是为每个Item四周预留出空间，从而让分隔线的绘制在预留的空间内。

onDraw：通过该方法，在Canvas上绘制内容，在绘制Item之前调用。（如果没有通过getItemOffsets设置偏移的话，Item的内容会将其覆盖）
onDrawOver：通过该方法，在Canvas上绘制内容,在Item之后调用。(画的内容会覆盖在item的上层)

## RecyclerView 性能优化
- 数据处理和视图加载分离（数据处理放到非UI线程）
- 对于新增或者删除数据通过 DiffUtil 来进行局部刷新数据，而不是一味地全局刷新数据。
- 减少过渡绘制
- 减少 xml 文件 inflate 时间
- 设置 RecyclerView.addOnScrollListener(listener); 来对滑动过程中停止加载的操作
- 如果 Item 高度是固定的话，可以使用 RecyclerView.setHasFixedSize(true)
- 如果多个 RecycledView 的 Adapter 是一样的，比如嵌套的 RecyclerView 中存在一样的 Adapter，可以通过设置 RecyclerView.setRecycledViewPool(pool); 来共用一个 RecycledViewPool

## RecyclerView 缓存
- ArrayList mAttachedScrap：未与RecyclerView分离的ViewHolder列表,如果仍依赖于 RecyclerView （重新laypout的情况），但已经被标记移除的 ItemView 集合会被添加到 mAttachedScrap 中。方便快速加入回去。
- ArrayList mCachedViews：缓存ViewHolder，主要用于解决RecyclerView滑动抖动时的情况。
- ViewCacheExtension mViewCacheExtension
- mRecyclerPool ViewHolder缓存池，在有限的mCachedViews中如果存不下ViewHolder时，就会把ViewHolder存入RecyclerViewPool中。

## 布局优化
- AsynclayoutInflater异步创建View
- ConstraintLayout 降低布局层级
- 提前将 常用 layout 解析完读入到内存当中
- 使用异步布局框架Litho（异步布局 视图扁平化 高度回收 Drawable 渲染组件）


2023/11/1

与 ListView 对比，RecyclerView 的优点
RecyclerView 的缓存机制
final 关键字的作用，final 在多线程并发条件下的作用
线程安全
Map 接口的实现有哪几种，实现的特性是什么
LinkedHashMap 的实现机制
synchronized 作用于不同方法和代码块的区别
哪些方法可以创建线程池
BroadcastReceiver 和 LocalBroaccastReceiver 的区别
安卓的跨进程通信
DNS 域名解析过程
DNS 劫持
怎么用 OkHttp 监控数据请求的状态
听说 过 MVVM 么
触摸事件的传递机制
Looper 和 Handler 的关系
Window 机制中的 DecorView 的关系

DNS 解析过程
DNS 协议的可靠性的设计
DNS 协议改进方式
TCP 的拥塞控制机制
HTTP 和 HTTPS 的区别
HTTPS 怎么保证安全性的，具体的流程是什么样的
对称加密和非对称加密的区别
HTTP 的版本差异
进程和线程的区别
一个应用里面有多个进程么？回答 “可以” 了以后，继续问：在什么情况下需要一个应用里面有多个进程
在 Linux 系统下，有哪些进程调度的方式
跨进程通信的方式
信号量怎么理解
操作系统层面，怎么实现异常中断

网络：
http报文结构
http复用的是什么连接
https握手过程
对称加密和非对称加密优缺点和应用场景

kotlin：
你觉得kotlin相比java有什么优点
kotlin协程和线程相比有什么好处
协程底层怎么实现
协程怎么处理异常
kotlin泛型和java区别
sequence和list区别
Android用的开源库有什么了解吗 没有

1）View的事件分发机制？Activity的启动模式？

2）自定义View的步骤？需要重写哪些方法？

3）怎么自定义属性？线性布局和相对布局？

4）dpi、px和sp？

5）Android的几种动画器？怎么使用？

6）padding和margin？Await？

7）HashMap的实现原理？put()和get()的过程？

8）Error和Exception的区别？

9）JVM内存模型？JVM内存不足时要做什么？

10）TCP为什么要三次连接？滑动窗口？

为什么用MVVM、除了MVVM还认识什么架构（MVP）
MVVM实现的时候有没有用上DataBinding（答：LiveData）、LiveData原理（答：观察者模式，可以感知LifeCycle）
final关键字
synchronized关键字
java的集合类有哪些
List和set的区别
为什么重写equals一定要重写hashCode
InputStream/OutputStream和Reader/Writer的区别
kotlin协程和线程的区别（简历写了熟练掌握kotlin，项目用的也全是kotlin，所以才问的吧）
有接触过什么开源库吗（android用的基本没接触过，跳过了）
设计模式的了解和应用（举例举了一大堆，应用讲了单例模式和适配器模式）

1.能给我说说关于RecyclerView的LayoutManager相关的吗？（我只知道负责整个布局形式，比如横向纵向，流式布局，瀑布流布局这样）
2.如果让你设计一个布局，就拿你的简历来设计，你会如何设计？
针对可能需要显示或不需要显示的布局使用ViewStub标签，针对重复使用的布局用include标签
3.能说说Handler消息机制是什么样的吗？如何插入Message消息？（插入排序，按msg.when升序排列）
4.听你说了主线程阻塞？能讲讲为什么是阻塞吗？（这里是口误了，应该是主线程释放cpu，让CPU去执行其他任务，然后当消息队列中重新提交了新的任务时由底层去“唤醒”主线程从阻塞位置继续执行）
5.能给我讲一下Binder驱动底层是如何实现的，以及需要注意的地方是什么吗？
6.多进程之间如何进行进程间通讯呢？底层原理是什么样的呢？（linux：共享内存，管道，匿名管道，消息队列，信号量（同步），socket）
7.听你说了同步和互斥，你是如何在自己的多进程项目中实现同步呢？就是如何保证接受任务的有序性？（后台服务中开启子线程，然后使用handler的形式保证任务的有序执行）    ps：面试官给我解释了半天如何实现同步是什么意思，最后搞懂了他想说的含义，呜呜呜。


然后做了一道题：
判断一个数字是否是回文，条件：时间复杂度log10 n，不使用额外的空间，越快越好，我很快写了一个符合要求的，然后面试官问我能不能更快
我人傻了，直接将数字翻转然后判断难道不是更快吗？然后他说遍历一半，然后再判断会更快，


final 这个关键字有什么作用（修饰变量、方法、类）
了解过什么集合容器 （GG，List的忘了）

ArrayList 和 LinkedList 有什么区别、插入元素有什么区别

ArrayList 的扩容机制

HashMap 扩容机制、什么情况下扩容、加载因子、什么情况下转为红黑树

HashMap 原理、怎么解决哈希碰撞

equals 和 hashcode 的区别、使用场景

equals 和 hashcode 需要都重写吗？

Java实现线程安全的锁有什么（synchronized、ReentrantLock、Atomic的原子类）

synchronized 修饰成员方法和静态方法有什么区别

ReentrantLock 的实现原理是什么（AQS）

动态代理和反射

动态代理的实现原理（InvocationHandler）

Java 四大引用是什么

ThreadLocal 类的原理、ThreadLocalMap 中的 key 是什么类型的数据、存储的是什么

wait 和 sleep 的区别

http的 GET 和 POST 的区别

UDP 和 TCP 什么区别

算法：

删除链表的倒数第 n 个结点
LRU结构怎么设计、还可以怎么继续优化空间复杂度

1）在浏览器中输入一个网址打开网站的过程？DNS是哪层的协议？基于哪个传输层协议实现？为什么？

2）TCP连接建立的过程？拥塞控制？

3）说说HTTPS？对称加密和非对称加密？证书？HTTP1.0和HTTP1.1的区别？

4）concurrentHashMap的实现原理？

5）sleep()和wait()的区别？

6）有5个线程，要等它们执行完再去执行另外的线程，怎么实现？

7）软引用和弱引用的区别？

8）算法题：写一个单例模式。

1.自我介绍
2.weight属性的作用
3.动画使用过吗
4.Recyclerview中怎么实现分隔符
5.volatile和synchronized
6.讲一下构造方法、静态方法
7.重写和重载区别
8.讲一下handlerthread和thread
9.looper、handler、thread
10.输入url到渲染的过程
11.http的head
12.http和https的区别
13.有抓包过https吗，怎么抓包的
14.linux相关
15.平时怎么学习的
16.最近印象最深的问题怎么解决的
17.有关注哪些博客吗
18.有关注哪些开源项目吗

1、进程间通信方式？Binder原理？
2、Android性能优化的方式？（布局优化、卡顿优化）
这个问题问的很深入，问了Android卡顿优化的几个思路和实现，紧扣项目和实习经历
3、有用过CPU Profiler吗？火焰图怎么看？
4、怎么抓包？Charles、Mock等
4、HTTPS怎么实现安全的？问的非常深，包括中间人攻击啥的
5、TCP、UDP，三次握手四次挥手，为什么是三次，为什么是四次
6、DNS的原理和过程，怎么防止DNS污染
7、平时自己怎么学习安卓的，有什么方式

一个对象作为一个HashMap的key值需要重写哪些方法

hashMap结构

java类加载器有哪些

jvm类加载机制

gc垃圾回收算法，具体讲讲优缺点

Android用到的垃圾回收算法

线程池什么时候会创建线程

线程池拒绝策略

实现线程池的get与put方法

Linux跨进程通信

Android跨进程通信

ContentProvider如何实现的跨进程通信

http请求报文与应答报文的格式

http缓存机制

handler机制

事件分发机制

如何解决滑动冲突

view绘制流程

MeasureSpec包含哪些信息

MVVM层次机构

lambda表达式中如何退出表达式不退出函数

jetpack中与协程相关的扩展函数

ViewModelScope的好处

Retrofit如何指定一个完整的url进行请求

算法题

给定一个只有大小写字母组成的字符串，如果两个字母是大小写连着的就删除这两个字母。例如AaBfCc，删除之后变成Bf。

Android动画

ANR bug 如何排查

数据库事务的特性

事务的原子性

原子性的场景

数据库原子性如何实现的

java原子性如何实现的

synchronized锁住普通方法和静态方法的区别

volatile可见性如何实现

ViewModel原理

onSaveInstanceState与ViewModel存储数据的区别

TCP如何实现可靠性

拥塞控制如何实现

算法
leetcode 重排链表
用 Rand7() 实现 Rand4()，类似 leetcode470
